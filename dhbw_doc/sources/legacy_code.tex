\documentclass[12pt]{article}
\usepackage[ngerman]{babel}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{inconsolata}
\usepackage{color}
\usepackage{enumitem}
\usepackage[a4paper, left=2.5cm, right=2.5cm, top=2.5cm]{geometry}
\usepackage[onehalfspacing]{setspace}

\definecolor{pblue}{rgb}{0.13,0.13,1}
\definecolor{pgreen}{rgb}{0,0.5,0}
\definecolor{pred}{rgb}{0.9,0,0}
\definecolor{pgrey}{rgb}{0.46,0.45,0.48}

\usepackage{listings}
\lstset{language=Java,
  showspaces=false,
  showtabs=false,
  breaklines=true,
  showstringspaces=false,
  breakatwhitespace=true,
  commentstyle=\color{pgreen},
  keywordstyle=\color{pblue},
  stringstyle=\color{pred},
  basicstyle=\ttfamily,
  moredelim=[il][\textcolor{pgrey}]{$$},
  moredelim=[is][\textcolor{pgrey}]{\%\%}{\%\%}
}

\title{Legacy Code}
\date{DHBW Karlsruhe\\ Vorlesung Advanced Software Engineering Semester 5/6}
\author{Lukas Panni \\ TINF18B5}
\begin{document}
\maketitle

\newpage

\tableofcontents

\newpage

\section{Abhängigkeiten brechen}

Im folgenden sollen einige Beispiele aufgeführt werden, bei denen Abhängigkeiten mithilfe der in der Vorlesung behandelten Techniken beseitigt werden.
Ohne diese Abhängigkeiten sind Tests leichter zu entwickeln, sodass weitere Änderungen, zum Beispiel zur Verbesserung des Designs, später einfacher und komfortabler möglich sind.
Das Ziel beim Brechen der Abhängigkeiten ist es, die Testbarkeit der betroffenen Klassen beziehungsweise Methoden zu erhöhen.

\newpage

\subsection{ExtractInterface bei Commit \href{https://github.com/lukaspanni/OpenSourceStats/commit/1e47e7b2d42c04429a433a6ac3dbea781409d36d} {1e47e7b}}

\subsubsection*{\href{https://github.com/lukaspanni/OpenSourceStats/tree/0daf8862a81a976e3d6341f5b5461bc8d3c64b4f/app/src/main/java/de/lukaspanni/opensourcestats/auth/}{Ausgangszustand}}

Die Klasse \textit{AuthHandler} ist stark abhängig von der Android-Klasse \textit{Activity} und kann auch nicht erstellt werden ohne eine Instanz dieser Klasse der \textit{getInstance}-Methode zu übergeben.
Die Testbarkeit ist schlecht, da eine Android-\textit{Activity}-Instanz nicht ohne weiteres im Test-Kontext erstellt werden kann.
Auch ein Fake-Objekt ist schwer zu erstellen, da eine finale Methode genutzt wird, in Ableitungen von \textit{Activity} nicht überschrieben werden kann.
Da die Klasse \textit{AuthHandler} für die OAuth-Authentifizierung verantwortlich ist und damit wichtig für das Gesamtsystem, ist es wichtig, Tests für diese Klasse zu ermöglichen.

\subsubsection*{Gewählte Technik}

Die \textit{getInstance}-Methode benötigt eine Instanz der Klasse \textit{Activity}, die im Test-Kontext nicht leicht erstellbar ist und für die auch Fake-Objekte nur schwer erstellt werden können. Da allerdings nur wenige Methoden der \textit{Activity}-Klasse verwendet werden, und eine Änderung der \textit{AuthHandler} Klasse nur vergleichsweise wenige Änderungen erfordert, kann in diesem Fall \textbf{ExtractInterface} angewendet werden.
So wird die Abhängigkeit von \textit{AuthHandler} zu \textit{Activity} gelöst, indem das Interface \textit{AuthHandlerActivity} eingeführt und der Parameter von \textit{getInstance} angepasst wird, sodass eine Instanz vom Typ des Interfaces verwendet wird. Dabei werden auch kleinere Anpassungen an Methodenaufrufen vorgenommen, sodass Methoden des Interfaces aufgerufen werden.
\textbf{ExtractInterface} ist durch IDE-Unterstützung vergleichsweise einfach und ohne große Fehleranfälligkeit durchzuführen. Außerdem wird die Abstraktion durch diese Technik verbessert.

\subsubsection*{\href{https://github.com/lukaspanni/OpenSourceStats/tree/1e47e7b2d42c04429a433a6ac3dbea781409d36d/app/src/main/java/de/lukaspanni/opensourcestats/auth/}{Endzustand}}

\textit{AuthHandler} nutzt nach dieser Änderung nur noch die Methoden des Interfaces, wodurch die Testbarkeit erhöht wird.
Allerdings gibt es hier das Problem, dass \textit{AuthHandler} die Third-Party-Klasse \textit{AuthorizationService} verwendet, die auf eine \textit{Activity}-Instanz angewiesen ist.
Deshalb gibt es im neu eingeführten Interface eine Methode, die eine \textit{Activity} zurückgibt. Die Abhängigkeit konnte also in diesem Fall nicht komplett aufgelöst werden.
Trotzdem wurde die Testbarkeit erhöht und die Abstraktion verbessert. Diese Änderung stellt damit eine gute Basis für weitere Refactorings und Änderungen dar, wie zum Beispiel in Commit \href{https://github.com/lukaspanni/OpenSourceStats/commit/cbc53183a878d6507a02daebd55c9c7dfcae9c0f}{cbc5318}.

\newpage

\subsection{Parametrize Constructor bei Commit \href{https://github.com/lukaspanni/OpenSourceStats/commit/d098b93ffd042cb095af679254ed01584417763e} {d098b93}}

\subsubsection*{\href{https://github.com/lukaspanni/OpenSourceStats/tree/3b1eb5bf6750c3ccaeb05962ec8a8ae743adbf2c/app/src/main/java/de/lukaspanni/opensourcestats/repository}{Ausgangszustand}}

Die Klassen \textit{RepositoryDataRepository} und \textit{UserContributionsRepository} haben eine Abhängigkeit zur Klasse \textit{ResponseCache} und erzeugen im Konstruktor eine Instanz dieser Klasse und speichern diese in einer Instanzvariablen.
Für den Test der Klassen ist es hilfreich, diese Instanzvariable durch eine eigene Cache-Implementierung zu nutzen.
In diesem Fall lässt sich die Abhängigkeit mit Hilfe von \textbf{Parametrize Constructor} brechen.
\newline
Dazu wird ein neuer Konstruktor erzeugt, der einen zusätzlichen Parameter vom Typ der zu überschreibenden Instanzvariable entgegennimmt. In diesem Beispiel eine Instanz von \textit{ResponseCache}. Die existierenden Konstruktoren rufen den neuen Konstruktor mit dem ursprünglichen Wert der Variable auf.
Dabei bleibt die alte Funktionalität erhalten und es müssen keine Anpassungen an anderen Stellen erfolgen.

\subsubsection*{\href{https://github.com/lukaspanni/OpenSourceStats/tree/d098b93ffd042cb095af679254ed01584417763e/app/src/main/java/de/lukaspanni/opensourcestats/repository}{Endzustand}}

Durch das Brechen der Abhängigkeit ist es nun möglich, beim Erstellen einer Instanz vom Typ \textit{RepositoryDataRepository} oder \textit{UserContributionsRepository} ein \textit{ResponseCache}-Objekt zu übergeben. Dadurch kann zum Beispiel beim Test ein Fake-Objekt übergeben werden.


\end{document}